# Список задач

- Команда сервиса GiftCertificateProcessing
  - [1] Проектирование схемы GiftCertificateDB
    - Описание задачи: разработать ERD и миграции для таблиц `gift_certificate`, `gift_certificate_operation`, `authorization_hold`, `order_certificate_allocation`, `audit_log` (см. `specs/erd.md`), включая поля контроля уникальной продажи и атрибуты распределения платежей.
    - Definition of Done: миграции применены в dev/qa, ERD согласован, тестовые данные создаются автоматически.
    - Acceptance Criteria: таблицы соответствуют ERD, поддерживают основные атрибуты и связи, покрыты unit-тестами репозиториев, обеспечивают запрет повторной продажи кода.
    - Предполагаемый срок реализации: 3 недели.
    - Роли сотрудников для выполнения: архитектор данных, backend-разработчик, DevOps-инженер.
  - [2] Реализация событийных слушателей
    - Описание задачи: реализовать подписку на `All_SalesOrder` (парсинг `certificateLines`) и `All_Payments` (парсинг `certificateAllocations`) с корреляцией заказов, оплат и записей `order_certificate_allocation` (см. `specs/architecture.md`).
    - Definition of Done: логика корреляции покрыта интеграционными тестами, обеспечена идемпотентность и накопление `collected_amount`.
    - Acceptance Criteria: при получении тестового заказа и последовательности частичных оплат создаются записи `order_certificate_allocation`, корректно обновляется прогресс и после финального события активируются все сертификаты заказа с публикацией `GiftCertificateState`.
    - Предполагаемый срок реализации: 2 недели.
    - Роли сотрудников для выполнения: backend-разработчик, инженер по интеграциям, QA-инженер.
  - [3] API авторизации и списания
    - Описание задачи: реализовать REST-эндпоинты `authorize` / `capture` / `void` с поддержкой Redis-кэша (см. `specs/openapi.yaml`) и обработкой конфликтов `CodeAlreadySold`.
    - Definition of Done: API описан в OpenAPI, покрыт автотестами, настроен rate limiting.
    - Acceptance Criteria: каналы `OnlineStore` и `POS` успешно проводят авторизацию и списание в QA, баланс корректно обновляется, при повторной продаже возвращается 409 `CodeAlreadySold`.
    - Предполагаемый срок реализации: 3 недели.
    - Роли сотрудников для выполнения: backend-разработчик, инженер по безопасности, QA-инженер.
  - [4] Аудит и публикация событий
    - Описание задачи: реализовать аудит операций и публикацию событий `GiftCertificateTransaction` и `GiftCertificateBI` с включением статуса распределения (`allocation_status`) и идентификаторов `order_line_id` (см. `specs/architecture.md`, `specs/flows.md`).
    - Definition of Done: события логируются, доступны в Kafka, проведена проверка формата, реализован DLQ.
    - Acceptance Criteria: BI-коннектор получает тестовое событие с данными распределения и сохраняет в витрину, аудит отображает метаданные.
    - Предполагаемый срок реализации: 2 недели.
    - Роли сотрудников для выполнения: backend-разработчик, инженер по данным, инженер эксплуатации.

- Команда сервиса GiftCertificateBatchLoader
  - [5] Инструмент массовой загрузки
    - Описание задачи: создать инструмент/скрипт для формирования и отправки пакетов сертификатов (см. `specs/flows.md`).
    - Definition of Done: инструмент документирован, поддерживает dry-run и валидацию, CI контролирует качество.
    - Acceptance Criteria: тестовый пакет в QA приводит к созданию сертификатов, ошибки формируются в отчёте.
    - Предполагаемый срок реализации: 1 неделя.
    - Роли сотрудников для выполнения: backend-разработчик, инженер по данным, технический писатель.

- Команда сервиса OnlineStore
  - [6] Интеграция с API сертификатов
    - Описание задачи: добавить в фронт вызовы `authorize` / `capture` и отображение баланса (см. `specs/sequences.md`, `specs/openapi.yaml`).
    - Definition of Done: фронт покрыт e2e-тестами, UI отображает остаток, обрабатывает ошибки.
    - Acceptance Criteria: пользователь может применить сертификат и видеть итоговый баланс на QA; при попытке повторной продажи отображается ошибка бизнес-уровня.
    - Предполагаемый срок реализации: 2 недели.
    - Роли сотрудников для выполнения: frontend-разработчик, UX-дизайнер, QA-инженер.

- Команда сервиса POS
  - [7] Интеграция POS с API
    - Описание задачи: реализовать сценарии проверки баланса и списания в POS (см. `specs/sequences.md`).
    - Definition of Done: требования согласованы, тесты на кассовом окружении, инструкции для продавцов.
    - Acceptance Criteria: кассир проводит оплату сертификатом и получает чек с остатком; при повторной продаже кассир видит отказ `CodeAlreadySold`.
    - Предполагаемый срок реализации: 2 недели.
    - Роли сотрудников для выполнения: инженер POS-платформы, аналитик бизнес-процессов, тренер по обучению персонала.

- Команда сервиса Payments
  - [8] Обогащение событий оплат
    - Описание задачи: добавить к событиям `All_Payments` атрибуты, указывающие на покупку сертификата и операции возврата (см. `specs/architecture.md`), включая `paymentVersion`, `capturedAmount`, `outstandingAmount`, `isOrderSettled` и массив `certificateAllocations[]` (`orderLineId`, `allocatedAmount`, `currency`).
    - Definition of Done: изменения задокументированы, обратная совместимость сохранена, реализована схема в контрактных тестах.
    - Acceptance Criteria: `GiftCertificateProcessing` корректно накапливает суммы по `orderLineId`, активирует сертификаты только после события с `isOrderSettled=true`, частичные платежи отображаются в QA.
    - Предполагаемый срок реализации: 1 неделя.
    - Роли сотрудников для выполнения: backend-разработчик, инженер по интеграциям, QA-инженер.

- Команда сервиса BI Pipeline
  - [9] Коннектор GiftCertificateBI
    - Описание задачи: настроить потребление топика `GiftCertificateBI` и загрузку в витрину (см. `specs/architecture.md`, `specs/flow.mmd`).
    - Definition of Done: коннектор деплоен, мониторится, схемы документированы.
    - Acceptance Criteria: BI получает демо-набор событий и строит отчёт остатков.
    - Предполагаемый срок реализации: 2 недели.
    - Роли сотрудников для выполнения: инженер по данным, аналитик BI, DevOps-инженер.

- Команда сервиса SMS Gateway
  - [10] Отправка CVC по SMS
    - Описание задачи: настроить интеграцию с существующим SMS-шлюзом для доставки CVC (см. `specs/flows.md`).
    - Definition of Done: конфигурация хранится безопасно, предусмотрен повтор отправки.
    - Acceptance Criteria: при покупке сертификата в QA клиент получает SMS с CVC.
    - Предполагаемый срок реализации: 1 неделя.
    - Роли сотрудников для выполнения: инженер по интеграциям, специалист по информационной безопасности, QA-инженер.

- Команда сервиса Orders
  - [11] Расширение модели заказа для сертификатов
    - Описание задачи: добавить к позициям заказа атрибуты `certificateSku`, `plannedDenomination`, `intendedRecipient`, `orderLineId` и обеспечить хранение предпочтений покупателя (см. `specs/clarification.md`, `specs/architecture.md`).
    - Definition of Done: миграции применены, API Orders возвращает новые атрибуты, обновлены контрактные тесты.
    - Acceptance Criteria: фронты и интеграции получают обогащённые позиции сертификатов, данные корректно сохраняются и доступны в аналитике.
    - Предполагаемый срок реализации: 2 недели.
    - Роли сотрудников для выполнения: архитектор данных, backend-разработчик, QA-инженер.
  - [12] Публикация certificateLines в `All_SalesOrder`
    - Описание задачи: дополнить событие `All_SalesOrder` секцией `certificateLines[]` с суммами и получателями сертификатов (см. `specs/architecture.md`, `specs/sequences.md`).
    - Definition of Done: схема события обновлена, описана документацией, проведены consumer-тесты.
    - Acceptance Criteria: `GiftCertificateProcessing` получает событие с `certificateLines`, создаёт записи `order_certificate_allocation`, QA-интеграция подтверждает корректную корреляцию.
    - Предполагаемый срок реализации: 1 неделя.
    - Роли сотрудников для выполнения: backend-разработчик, инженер по интеграциям, QA-инженер.

# Список задач

## GiftCertificateProcessing

[1, Проектирование схемы GiftCertificateDB, Разработать ERD и миграции для таблиц gift_certificate, gift_certificate_operation, authorization_hold, audit_log., Миграции применяются в dev/qa, ERD согласован, тестовые данные создаются автоматически., Таблицы соответствуют ERD, поддерживают основные атрибуты и связи, покрыты unit-тестами репозиториев., 3 недели]
[2, Реализация событийных слушателей, Реализовать подписку на All_SalesOrder и All_Payments с корреляцией заказов и оплат., Логика корреляции покрыта интеграционными тестами, обеспечена идемпотентность., При получении тестового заказа и оплаты создаётся активированный сертификат и событие GiftCertificateState., 2 недели]
[3, API авторизации и списания, Реализовать REST-эндпоинты authorize/capture/void с поддержкой Redis-кэша., API описан в OpenAPI, покрыт автотестами, настроен rate limiting., Каналы OnlineStore/POS успешно проводят авторизацию и списание в QA, баланс корректно обновляется., 3 недели]
[4, Аудит и публикация событий, Реализовать аудит операций и публикацию событий GiftCertificateTransaction и GiftCertificateBI., События логируются, доступны в Kafka, проведена проверка формата, реализован DLQ., BI коннектор получает тестовое событие и сохраняет в витрину, аудит отображает метаданные., 2 недели]

## GiftCertificateBatchLoader

[5, Инструмент массовой загрузки, Создать инструмент/скрипт для формирования и отправки пакетов сертификатов., Инструмент документирован, поддерживает dry-run и валидацию, CI контролирует качество., Тестовый пакет в QA приводит к созданию сертификатов, ошибки формируются в отчёте., 1 неделя]

## OnlineStore

[6, Интеграция с API сертификатов, Добавить в фронт вызовы authorize/capture и отображение баланса., Фронт покрыт e2e-тестами, UI отображает остаток, обрабатывает ошибки., Пользователь может применить сертификат и видеть итоговый баланс на QA., 2 недели]

## POS

[7, Интеграция POS с API, Реализовать сценарии проверки баланса и списания в POS., Требования согласованы, тесты на кассовом окружении, инструкции для продавцов., Кассир проводит оплату сертификатом и получает чек с остатком., 2 недели]

## Payments

[8, Обогащение событий оплат, Добавить к событиям All_Payments атрибуты, указывающие на покупку сертификата и операции возврата., Изменения задокументированы, обратная совместимость сохранена., GiftCertificateProcessing корректно активирует сертификат на основе события в QA., 1 неделя]

## BI Pipeline

[9, Коннектор GiftCertificateBI, Настроить потребление топика GiftCertificateBI и загрузку в витрину., Коннектор деплоен, мониторится, схемы документированы., BI получает демо-набор событий и строит отчёт остатков., 2 недели]

## SMS Gateway

[10, Отправка CVC по SMS, Настроить интеграцию с существующим SMS-шлюзом для доставки CVC., Конфигурация хранится безопасно, предусмотрен повтор отправки., При покупке сертификата в QA клиент получает SMS с CVC., 1 неделя]

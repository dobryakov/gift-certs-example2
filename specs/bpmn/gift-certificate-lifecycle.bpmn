<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" id="Definitions_GiftCertificateLifecycle" targetNamespace="http://company.example/gift-certificates">
  <bpmn:process id="Process_GiftCertificateLifecycle" name="Gift Certificate Lifecycle" isExecutable="false">
    <bpmn:laneSet id="LaneSet_GiftCertificateLifecycle">
      <bpmn:lane id="Lane_InternetStore" name="Internet Store">
        <bpmn:flowNodeRef>StartEvent_IM_Order</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_IM_RequestNext</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_IM_PublishOrder</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_IM_PublishPayment</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_IM_UpdateUI</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_POS" name="POS">
        <bpmn:flowNodeRef>StartEvent_POS_Order</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_POS_RequestNext</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_POS_PublishOrder</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_POS_PublishPayment</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_POS_UpdatePOS</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_Orders" name="Orders">
        <bpmn:flowNodeRef>Task_Orders_RouteOrderOnline</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Orders_RouteOrderOffline</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Orders_PublishPartialRedeem</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Orders_PublishFullRedeem</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Orders_PublishRefund</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_Payments" name="Payments">
        <bpmn:flowNodeRef>Task_Payments_RoutePaymentOnline</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Payments_RoutePaymentOffline</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Payments_PublishPartialRedeem</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Payments_PublishFullRedeem</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Payments_PublishRefund</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_GCP" name="Сервис Процессинга Подарочных Сертификатов">
        <bpmn:flowNodeRef>Task_GCP_ReserveCertificate</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_PoolAvailable</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>IntermediateEvent_IssueBlocked</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_ChannelBranch</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_CorrelateEvents</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_PublishInitial</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>ParallelGateway_Notify</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_MarkNotificationSent</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_PublishNotificationSent</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>ParallelGateway_JoinAfterNotification</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_NextEvent</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_UpdatePartialRedeem</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_PublishPartialRedeem</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_UpdateRedeemed</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_PublishRedeemed</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_UpdateRefund</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_PublishRefund</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_LockCertificate</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_PublishLocked</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_UnlockCertificate</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_GCP_PublishUnlocked</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_PoolEmpty</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_LifecycleCompleted</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_CRM" name="CRM">
        <bpmn:flowNodeRef>Task_CRM_RequestCVC</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_CRM_SendCVC</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_Support" name="Support Desk">
        <bpmn:flowNodeRef>Task_Support_LockRequest</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Support_UnlockRequest</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_BI" name="BI Platform">
        <bpmn:flowNodeRef>Task_BI_UpdateAnalyticsInitial</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_BI_UpdatePartial</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_BI_CloseCertificate</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_BI_UpdateRefund</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_BI_UpdateLocked</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_BI_UpdateUnlocked</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:startEvent id="StartEvent_IM_Order" name="Заказ на сертификат (ONLINE)">
      <bpmn:outgoing>Flow_IM_Start_To_Request</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:task id="Task_IM_RequestNext" name="POST /certificates/next (channel=ONLINE)">
      <bpmn:incoming>Flow_IM_Start_To_Request</bpmn:incoming>
      <bpmn:outgoing>Flow_IM_Request_To_Reserve</bpmn:outgoing>
    </bpmn:task>
    <bpmn:startEvent id="StartEvent_POS_Order" name="Заказ на сертификат (OFFLINE)">
      <bpmn:outgoing>Flow_POS_Start_To_Request</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:task id="Task_POS_RequestNext" name="POST /certificates/next (channel=OFFLINE)">
      <bpmn:incoming>Flow_POS_Start_To_Request</bpmn:incoming>
      <bpmn:outgoing>Flow_POS_Request_To_Reserve</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_ReserveCertificate" name="Зарезервировать сертификат">
      <bpmn:incoming>Flow_IM_Request_To_Reserve</bpmn:incoming>
      <bpmn:incoming>Flow_POS_Request_To_Reserve</bpmn:incoming>
      <bpmn:outgoing>Flow_Reserve_To_Gateway</bpmn:outgoing>
    </bpmn:task>
    <bpmn:exclusiveGateway id="Gateway_PoolAvailable" name="Сертификат доступен?">
      <bpmn:incoming>Flow_Reserve_To_Gateway</bpmn:incoming>
      <bpmn:outgoing>Flow_Pool_No</bpmn:outgoing>
      <bpmn:outgoing>Flow_Pool_Yes</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:intermediateThrowEvent id="IntermediateEvent_IssueBlocked" name="GiftCertificates.Stream: ISSUE_BLOCKED">
      <bpmn:incoming>Flow_Pool_No</bpmn:incoming>
      <bpmn:outgoing>Flow_IssueBlocked_To_End</bpmn:outgoing>
    </bpmn:intermediateThrowEvent>
    <bpmn:endEvent id="EndEvent_PoolEmpty" name="Запас исчерпан">
      <bpmn:incoming>Flow_IssueBlocked_To_End</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="Gateway_ChannelBranch" name="Источник заказа?">
      <bpmn:incoming>Flow_Pool_Yes</bpmn:incoming>
      <bpmn:outgoing>Flow_Channel_To_IM</bpmn:outgoing>
      <bpmn:outgoing>Flow_Channel_To_POS</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:task id="Task_IM_PublishOrder" name="Публикация заказа (All_SalesOrder, ONLINE)">
      <bpmn:incoming>Flow_Channel_To_IM</bpmn:incoming>
      <bpmn:outgoing>Flow_IM_Order_To_Orders</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Orders_RouteOrderOnline" name="Orders: маршрутизация заказа ONLINE">
      <bpmn:incoming>Flow_IM_Order_To_Orders</bpmn:incoming>
      <bpmn:outgoing>Flow_OrdersOnline_To_IMPayment</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_IM_PublishPayment" name="Публикация платежа (All_Payments, ONLINE)">
      <bpmn:incoming>Flow_OrdersOnline_To_IMPayment</bpmn:incoming>
      <bpmn:outgoing>Flow_IMPayment_To_PaymentsOnline</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Payments_RoutePaymentOnline" name="Payments: маршрутизация платежа ONLINE">
      <bpmn:incoming>Flow_IMPayment_To_PaymentsOnline</bpmn:incoming>
      <bpmn:outgoing>Flow_PaymentsOnline_To_Correlate</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_POS_PublishOrder" name="Публикация заказа (All_SalesOrder, OFFLINE)">
      <bpmn:incoming>Flow_Channel_To_POS</bpmn:incoming>
      <bpmn:outgoing>Flow_POS_Order_To_OrdersOffline</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Orders_RouteOrderOffline" name="Orders: маршрутизация заказа OFFLINE">
      <bpmn:incoming>Flow_POS_Order_To_OrdersOffline</bpmn:incoming>
      <bpmn:outgoing>Flow_OrdersOffline_To_POSPayment</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_POS_PublishPayment" name="Публикация платежа (All_Payments, OFFLINE)">
      <bpmn:incoming>Flow_OrdersOffline_To_POSPayment</bpmn:incoming>
      <bpmn:outgoing>Flow_POSPayment_To_PaymentsOffline</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Payments_RoutePaymentOffline" name="Payments: маршрутизация платежа OFFLINE">
      <bpmn:incoming>Flow_POSPayment_To_PaymentsOffline</bpmn:incoming>
      <bpmn:outgoing>Flow_PaymentsOffline_To_Correlate</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_CorrelateEvents" name="Корреляция заказа и платежа">
      <bpmn:incoming>Flow_PaymentsOnline_To_Correlate</bpmn:incoming>
      <bpmn:incoming>Flow_PaymentsOffline_To_Correlate</bpmn:incoming>
      <bpmn:outgoing>Flow_Correlate_To_PublishInitial</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_PublishInitial" name="GiftCertificates.Stream: ISSUED + NOTIFICATION_REQUESTED">
      <bpmn:incoming>Flow_Correlate_To_PublishInitial</bpmn:incoming>
      <bpmn:outgoing>Flow_PublishInitial_To_Notify</bpmn:outgoing>
    </bpmn:task>
    <bpmn:parallelGateway id="ParallelGateway_Notify" name="Рассылка статуса">
      <bpmn:incoming>Flow_PublishInitial_To_Notify</bpmn:incoming>
      <bpmn:outgoing>Flow_Notify_To_IMUpdate</bpmn:outgoing>
      <bpmn:outgoing>Flow_Notify_To_POSUpdate</bpmn:outgoing>
      <bpmn:outgoing>Flow_Notify_To_CRMRequest</bpmn:outgoing>
      <bpmn:outgoing>Flow_Notify_To_BIInitial</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:task id="Task_IM_UpdateUI" name="Получение статуса сертификата (ONLINE)">
      <bpmn:incoming>Flow_Notify_To_IMUpdate</bpmn:incoming>
      <bpmn:outgoing>Flow_IMUpdate_To_Join</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_POS_UpdatePOS" name="Получение статуса сертификата (OFFLINE)">
      <bpmn:incoming>Flow_Notify_To_POSUpdate</bpmn:incoming>
      <bpmn:outgoing>Flow_POSUpdate_To_Join</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_CRM_RequestCVC" name="GET /certificates/{id}/cvc">
      <bpmn:incoming>Flow_Notify_To_CRMRequest</bpmn:incoming>
      <bpmn:outgoing>Flow_CRMRequest_To_CRMSend</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_CRM_SendCVC" name="Отправить CVC клиенту">
      <bpmn:incoming>Flow_CRMRequest_To_CRMSend</bpmn:incoming>
      <bpmn:outgoing>Flow_CRMSend_To_MarkNotification</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_MarkNotificationSent" name="Зафиксировать уведомление">
      <bpmn:incoming>Flow_CRMSend_To_MarkNotification</bpmn:incoming>
      <bpmn:outgoing>Flow_MarkNotification_To_PublishNotification</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_PublishNotificationSent" name="GiftCertificates.Stream: NOTIFICATION_SENT">
      <bpmn:incoming>Flow_MarkNotification_To_PublishNotification</bpmn:incoming>
      <bpmn:outgoing>Flow_PublishNotification_To_Join</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_BI_UpdateAnalyticsInitial" name="Обновить витрины BI (issue)">
      <bpmn:incoming>Flow_Notify_To_BIInitial</bpmn:incoming>
      <bpmn:outgoing>Flow_BIInitial_To_Join</bpmn:outgoing>
    </bpmn:task>
    <bpmn:parallelGateway id="ParallelGateway_JoinAfterNotification" name="Синхронизация каналов">
      <bpmn:incoming>Flow_IMUpdate_To_Join</bpmn:incoming>
      <bpmn:incoming>Flow_POSUpdate_To_Join</bpmn:incoming>
      <bpmn:incoming>Flow_PublishNotification_To_Join</bpmn:incoming>
      <bpmn:incoming>Flow_BIInitial_To_Join</bpmn:incoming>
      <bpmn:outgoing>Flow_Join_To_NextEvent</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:exclusiveGateway id="Gateway_NextEvent" name="Следующее событие?" default="Flow_Next_Default_End">
      <bpmn:incoming>Flow_Join_To_NextEvent</bpmn:incoming>
      <bpmn:incoming>Flow_Partial_BI_To_Gateway</bpmn:incoming>
      <bpmn:incoming>Flow_Lock_BI_To_Gateway</bpmn:incoming>
      <bpmn:incoming>Flow_Unlock_BI_To_Gateway</bpmn:incoming>
      <bpmn:outgoing>Flow_Next_Default_End</bpmn:outgoing>
      <bpmn:outgoing>Flow_Next_To_Partial</bpmn:outgoing>
      <bpmn:outgoing>Flow_Next_To_Full</bpmn:outgoing>
      <bpmn:outgoing>Flow_Next_To_Refund</bpmn:outgoing>
      <bpmn:outgoing>Flow_Next_To_Lock</bpmn:outgoing>
      <bpmn:outgoing>Flow_Next_To_Unlock</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:task id="Task_Orders_PublishPartialRedeem" name="Orders: обновить заказ (PARTIAL_REDEEM)">
      <bpmn:incoming>Flow_Next_To_Partial</bpmn:incoming>
      <bpmn:outgoing>Flow_Partial_Orders_To_Payments</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Payments_PublishPartialRedeem" name="Payments: провести частичное списание">
      <bpmn:incoming>Flow_Partial_Orders_To_Payments</bpmn:incoming>
      <bpmn:outgoing>Flow_Partial_Payments_To_Update</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_UpdatePartialRedeem" name="Обновить остаток сертификата">
      <bpmn:incoming>Flow_Partial_Payments_To_Update</bpmn:incoming>
      <bpmn:outgoing>Flow_Partial_Update_To_Publish</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_PublishPartialRedeem" name="GiftCertificates.Stream: PARTIALLY_REDEEMED">
      <bpmn:incoming>Flow_Partial_Update_To_Publish</bpmn:incoming>
      <bpmn:outgoing>Flow_Partial_Publish_To_BI</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_BI_UpdatePartial" name="BI: обновить отчёты (partial)">
      <bpmn:incoming>Flow_Partial_Publish_To_BI</bpmn:incoming>
      <bpmn:outgoing>Flow_Partial_BI_To_Gateway</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Orders_PublishFullRedeem" name="Orders: обновить заказ (REDEEMED)">
      <bpmn:incoming>Flow_Next_To_Full</bpmn:incoming>
      <bpmn:outgoing>Flow_Full_Orders_To_Payments</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Payments_PublishFullRedeem" name="Payments: провести полное списание">
      <bpmn:incoming>Flow_Full_Orders_To_Payments</bpmn:incoming>
      <bpmn:outgoing>Flow_Full_Payments_To_Update</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_UpdateRedeemed" name="Завершить сертификат">
      <bpmn:incoming>Flow_Full_Payments_To_Update</bpmn:incoming>
      <bpmn:outgoing>Flow_Full_Update_To_Publish</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_PublishRedeemed" name="GiftCertificates.Stream: REDEEMED">
      <bpmn:incoming>Flow_Full_Update_To_Publish</bpmn:incoming>
      <bpmn:outgoing>Flow_Full_Publish_To_BI</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_BI_CloseCertificate" name="BI: зафиксировать погашение">
      <bpmn:incoming>Flow_Full_Publish_To_BI</bpmn:incoming>
      <bpmn:outgoing>Flow_Full_BI_To_End</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Orders_PublishRefund" name="Orders: обновить заказ (REFUND)">
      <bpmn:incoming>Flow_Next_To_Refund</bpmn:incoming>
      <bpmn:outgoing>Flow_Refund_Orders_To_Payments</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Payments_PublishRefund" name="Payments: провести возврат">
      <bpmn:incoming>Flow_Refund_Orders_To_Payments</bpmn:incoming>
      <bpmn:outgoing>Flow_Refund_Payments_To_Update</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_UpdateRefund" name="Обновить статус возврата">
      <bpmn:incoming>Flow_Refund_Payments_To_Update</bpmn:incoming>
      <bpmn:outgoing>Flow_Refund_Update_To_Publish</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_PublishRefund" name="GiftCertificates.Stream: REFUND_PENDING / REFUNDED">
      <bpmn:incoming>Flow_Refund_Update_To_Publish</bpmn:incoming>
      <bpmn:outgoing>Flow_Refund_Publish_To_BI</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_BI_UpdateRefund" name="BI: обновить отчёты (refund)">
      <bpmn:incoming>Flow_Refund_Publish_To_BI</bpmn:incoming>
      <bpmn:outgoing>Flow_Refund_BI_To_End</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Support_LockRequest" name="POST /certificates/{id}/actions/lock">
      <bpmn:incoming>Flow_Next_To_Lock</bpmn:incoming>
      <bpmn:outgoing>Flow_Lock_Support_To_GCP</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_LockCertificate" name="Заблокировать сертификат">
      <bpmn:incoming>Flow_Lock_Support_To_GCP</bpmn:incoming>
      <bpmn:outgoing>Flow_Lock_GCP_To_Publish</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_PublishLocked" name="GiftCertificates.Stream: LOCKED">
      <bpmn:incoming>Flow_Lock_GCP_To_Publish</bpmn:incoming>
      <bpmn:outgoing>Flow_Lock_Publish_To_BI</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_BI_UpdateLocked" name="BI: зафиксировать блокировку">
      <bpmn:incoming>Flow_Lock_Publish_To_BI</bpmn:incoming>
      <bpmn:outgoing>Flow_Lock_BI_To_Gateway</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_Support_UnlockRequest" name="POST /certificates/{id}/actions/unlock">
      <bpmn:incoming>Flow_Next_To_Unlock</bpmn:incoming>
      <bpmn:outgoing>Flow_Unlock_Support_To_GCP</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_UnlockCertificate" name="Разблокировать сертификат">
      <bpmn:incoming>Flow_Unlock_Support_To_GCP</bpmn:incoming>
      <bpmn:outgoing>Flow_Unlock_GCP_To_Publish</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_GCP_PublishUnlocked" name="GiftCertificates.Stream: ACTIVE">
      <bpmn:incoming>Flow_Unlock_GCP_To_Publish</bpmn:incoming>
      <bpmn:outgoing>Flow_Unlock_Publish_To_BI</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_BI_UpdateUnlocked" name="BI: снять блокировку">
      <bpmn:incoming>Flow_Unlock_Publish_To_BI</bpmn:incoming>
      <bpmn:outgoing>Flow_Unlock_BI_To_Gateway</bpmn:outgoing>
    </bpmn:task>
    <bpmn:endEvent id="EndEvent_LifecycleCompleted" name="Жизненный цикл завершён">
      <bpmn:incoming>Flow_Next_Default_End</bpmn:incoming>
      <bpmn:incoming>Flow_Full_BI_To_End</bpmn:incoming>
      <bpmn:incoming>Flow_Refund_BI_To_End</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_IM_Start_To_Request" sourceRef="StartEvent_IM_Order" targetRef="Task_IM_RequestNext"/>
    <bpmn:sequenceFlow id="Flow_IM_Request_To_Reserve" sourceRef="Task_IM_RequestNext" targetRef="Task_GCP_ReserveCertificate"/>
    <bpmn:sequenceFlow id="Flow_POS_Start_To_Request" sourceRef="StartEvent_POS_Order" targetRef="Task_POS_RequestNext"/>
    <bpmn:sequenceFlow id="Flow_POS_Request_To_Reserve" sourceRef="Task_POS_RequestNext" targetRef="Task_GCP_ReserveCertificate"/>
    <bpmn:sequenceFlow id="Flow_Reserve_To_Gateway" sourceRef="Task_GCP_ReserveCertificate" targetRef="Gateway_PoolAvailable"/>
    <bpmn:sequenceFlow id="Flow_Pool_No" sourceRef="Gateway_PoolAvailable" targetRef="IntermediateEvent_IssueBlocked"/>
    <bpmn:sequenceFlow id="Flow_IssueBlocked_To_End" sourceRef="IntermediateEvent_IssueBlocked" targetRef="EndEvent_PoolEmpty"/>
    <bpmn:sequenceFlow id="Flow_Pool_Yes" sourceRef="Gateway_PoolAvailable" targetRef="Gateway_ChannelBranch"/>
    <bpmn:sequenceFlow id="Flow_Channel_To_IM" sourceRef="Gateway_ChannelBranch" targetRef="Task_IM_PublishOrder"/>
    <bpmn:sequenceFlow id="Flow_Channel_To_POS" sourceRef="Gateway_ChannelBranch" targetRef="Task_POS_PublishOrder"/>
    <bpmn:sequenceFlow id="Flow_IM_Order_To_Orders" sourceRef="Task_IM_PublishOrder" targetRef="Task_Orders_RouteOrderOnline"/>
    <bpmn:sequenceFlow id="Flow_OrdersOnline_To_IMPayment" sourceRef="Task_Orders_RouteOrderOnline" targetRef="Task_IM_PublishPayment"/>
    <bpmn:sequenceFlow id="Flow_IMPayment_To_PaymentsOnline" sourceRef="Task_IM_PublishPayment" targetRef="Task_Payments_RoutePaymentOnline"/>
    <bpmn:sequenceFlow id="Flow_PaymentsOnline_To_Correlate" sourceRef="Task_Payments_RoutePaymentOnline" targetRef="Task_GCP_CorrelateEvents"/>
    <bpmn:sequenceFlow id="Flow_POS_Order_To_OrdersOffline" sourceRef="Task_POS_PublishOrder" targetRef="Task_Orders_RouteOrderOffline"/>
    <bpmn:sequenceFlow id="Flow_OrdersOffline_To_POSPayment" sourceRef="Task_Orders_RouteOrderOffline" targetRef="Task_POS_PublishPayment"/>
    <bpmn:sequenceFlow id="Flow_POSPayment_To_PaymentsOffline" sourceRef="Task_POS_PublishPayment" targetRef="Task_Payments_RoutePaymentOffline"/>
    <bpmn:sequenceFlow id="Flow_PaymentsOffline_To_Correlate" sourceRef="Task_Payments_RoutePaymentOffline" targetRef="Task_GCP_CorrelateEvents"/>
    <bpmn:sequenceFlow id="Flow_Correlate_To_PublishInitial" sourceRef="Task_GCP_CorrelateEvents" targetRef="Task_GCP_PublishInitial"/>
    <bpmn:sequenceFlow id="Flow_PublishInitial_To_Notify" sourceRef="Task_GCP_PublishInitial" targetRef="ParallelGateway_Notify"/>
    <bpmn:sequenceFlow id="Flow_Notify_To_IMUpdate" sourceRef="ParallelGateway_Notify" targetRef="Task_IM_UpdateUI"/>
    <bpmn:sequenceFlow id="Flow_IMUpdate_To_Join" sourceRef="Task_IM_UpdateUI" targetRef="ParallelGateway_JoinAfterNotification"/>
    <bpmn:sequenceFlow id="Flow_Notify_To_POSUpdate" sourceRef="ParallelGateway_Notify" targetRef="Task_POS_UpdatePOS"/>
    <bpmn:sequenceFlow id="Flow_POSUpdate_To_Join" sourceRef="Task_POS_UpdatePOS" targetRef="ParallelGateway_JoinAfterNotification"/>
    <bpmn:sequenceFlow id="Flow_Notify_To_CRMRequest" sourceRef="ParallelGateway_Notify" targetRef="Task_CRM_RequestCVC"/>
    <bpmn:sequenceFlow id="Flow_CRMRequest_To_CRMSend" sourceRef="Task_CRM_RequestCVC" targetRef="Task_CRM_SendCVC"/>
    <bpmn:sequenceFlow id="Flow_CRMSend_To_MarkNotification" sourceRef="Task_CRM_SendCVC" targetRef="Task_GCP_MarkNotificationSent"/>
    <bpmn:sequenceFlow id="Flow_MarkNotification_To_PublishNotification" sourceRef="Task_GCP_MarkNotificationSent" targetRef="Task_GCP_PublishNotificationSent"/>
    <bpmn:sequenceFlow id="Flow_PublishNotification_To_Join" sourceRef="Task_GCP_PublishNotificationSent" targetRef="ParallelGateway_JoinAfterNotification"/>
    <bpmn:sequenceFlow id="Flow_Notify_To_BIInitial" sourceRef="ParallelGateway_Notify" targetRef="Task_BI_UpdateAnalyticsInitial"/>
    <bpmn:sequenceFlow id="Flow_BIInitial_To_Join" sourceRef="Task_BI_UpdateAnalyticsInitial" targetRef="ParallelGateway_JoinAfterNotification"/>
    <bpmn:sequenceFlow id="Flow_Join_To_NextEvent" sourceRef="ParallelGateway_JoinAfterNotification" targetRef="Gateway_NextEvent"/>
    <bpmn:sequenceFlow id="Flow_Next_Default_End" sourceRef="Gateway_NextEvent" targetRef="EndEvent_LifecycleCompleted"/>
    <bpmn:sequenceFlow id="Flow_Next_To_Partial" sourceRef="Gateway_NextEvent" targetRef="Task_Orders_PublishPartialRedeem"/>
    <bpmn:sequenceFlow id="Flow_Partial_Orders_To_Payments" sourceRef="Task_Orders_PublishPartialRedeem" targetRef="Task_Payments_PublishPartialRedeem"/>
    <bpmn:sequenceFlow id="Flow_Partial_Payments_To_Update" sourceRef="Task_Payments_PublishPartialRedeem" targetRef="Task_GCP_UpdatePartialRedeem"/>
    <bpmn:sequenceFlow id="Flow_Partial_Update_To_Publish" sourceRef="Task_GCP_UpdatePartialRedeem" targetRef="Task_GCP_PublishPartialRedeem"/>
    <bpmn:sequenceFlow id="Flow_Partial_Publish_To_BI" sourceRef="Task_GCP_PublishPartialRedeem" targetRef="Task_BI_UpdatePartial"/>
    <bpmn:sequenceFlow id="Flow_Partial_BI_To_Gateway" sourceRef="Task_BI_UpdatePartial" targetRef="Gateway_NextEvent"/>
    <bpmn:sequenceFlow id="Flow_Next_To_Full" sourceRef="Gateway_NextEvent" targetRef="Task_Orders_PublishFullRedeem"/>
    <bpmn:sequenceFlow id="Flow_Full_Orders_To_Payments" sourceRef="Task_Orders_PublishFullRedeem" targetRef="Task_Payments_PublishFullRedeem"/>
    <bpmn:sequenceFlow id="Flow_Full_Payments_To_Update" sourceRef="Task_Payments_PublishFullRedeem" targetRef="Task_GCP_UpdateRedeemed"/>
    <bpmn:sequenceFlow id="Flow_Full_Update_To_Publish" sourceRef="Task_GCP_UpdateRedeemed" targetRef="Task_GCP_PublishRedeemed"/>
    <bpmn:sequenceFlow id="Flow_Full_Publish_To_BI" sourceRef="Task_GCP_PublishRedeemed" targetRef="Task_BI_CloseCertificate"/>
    <bpmn:sequenceFlow id="Flow_Full_BI_To_End" sourceRef="Task_BI_CloseCertificate" targetRef="EndEvent_LifecycleCompleted"/>
    <bpmn:sequenceFlow id="Flow_Next_To_Refund" sourceRef="Gateway_NextEvent" targetRef="Task_Orders_PublishRefund"/>
    <bpmn:sequenceFlow id="Flow_Refund_Orders_To_Payments" sourceRef="Task_Orders_PublishRefund" targetRef="Task_Payments_PublishRefund"/>
    <bpmn:sequenceFlow id="Flow_Refund_Payments_To_Update" sourceRef="Task_Payments_PublishRefund" targetRef="Task_GCP_UpdateRefund"/>
    <bpmn:sequenceFlow id="Flow_Refund_Update_To_Publish" sourceRef="Task_GCP_UpdateRefund" targetRef="Task_GCP_PublishRefund"/>
    <bpmn:sequenceFlow id="Flow_Refund_Publish_To_BI" sourceRef="Task_GCP_PublishRefund" targetRef="Task_BI_UpdateRefund"/>
    <bpmn:sequenceFlow id="Flow_Refund_BI_To_End" sourceRef="Task_BI_UpdateRefund" targetRef="EndEvent_LifecycleCompleted"/>
    <bpmn:sequenceFlow id="Flow_Next_To_Lock" sourceRef="Gateway_NextEvent" targetRef="Task_Support_LockRequest"/>
    <bpmn:sequenceFlow id="Flow_Lock_Support_To_GCP" sourceRef="Task_Support_LockRequest" targetRef="Task_GCP_LockCertificate"/>
    <bpmn:sequenceFlow id="Flow_Lock_GCP_To_Publish" sourceRef="Task_GCP_LockCertificate" targetRef="Task_GCP_PublishLocked"/>
    <bpmn:sequenceFlow id="Flow_Lock_Publish_To_BI" sourceRef="Task_GCP_PublishLocked" targetRef="Task_BI_UpdateLocked"/>
    <bpmn:sequenceFlow id="Flow_Lock_BI_To_Gateway" sourceRef="Task_BI_UpdateLocked" targetRef="Gateway_NextEvent"/>
    <bpmn:sequenceFlow id="Flow_Next_To_Unlock" sourceRef="Gateway_NextEvent" targetRef="Task_Support_UnlockRequest"/>
    <bpmn:sequenceFlow id="Flow_Unlock_Support_To_GCP" sourceRef="Task_Support_UnlockRequest" targetRef="Task_GCP_UnlockCertificate"/>
    <bpmn:sequenceFlow id="Flow_Unlock_GCP_To_Publish" sourceRef="Task_GCP_UnlockCertificate" targetRef="Task_GCP_PublishUnlocked"/>
    <bpmn:sequenceFlow id="Flow_Unlock_Publish_To_BI" sourceRef="Task_GCP_PublishUnlocked" targetRef="Task_BI_UpdateUnlocked"/>
    <bpmn:sequenceFlow id="Flow_Unlock_BI_To_Gateway" sourceRef="Task_BI_UpdateUnlocked" targetRef="Gateway_NextEvent"/>
  </bpmn:process>
</bpmn:definitions>

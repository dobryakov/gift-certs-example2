При оформлении заказа ИМ или POS оформляют заказ как объект в All_SalesOrder, а платежи в All_Payments, а не http-запросом к Payments.
Сервис процессинга не генерирует сертификаты на ходу, он предоставляет HTTP API метод для выдачи следующего сертификата (get next cert).
CRM получает событие о необходимости отправить CVC, но сама не располагает этими данными, она должна обраться к сервису процессинга сертификатов.
Когда клиент оплачивает покупку, частично или полностью используя сертификат, используются имеющиеся потоки - заказ как объект в All_SalesOrder, а платежи в All_Payments.
Когда клиент запрашивает возврат средств по сертификату, следует также использовать имеющиеся потоки - заказ как объект в All_SalesOrder, а платежи в All_Payments, придумай решение в таком виде.
Объедини все потоки GiftCertificate.Commands, GiftCertificate.Notifications, GiftCertificate.Audit в единый поток, так как этого требуют корпоративные правила.
